# 结题报告

## 目录

## 项目介绍(tobedone)

我们这个项目是基于 2021 年的 x-DisGraFS 以及 2020 年的 x-dontpanic 展开。DisGraFS 是一个分布式图文件系统，该项目学习总结了当今主流几个分布式文件系统的优点，并且将文件标签与图结构联系起来描述文件之间的关系，统一了单机文件系统和分布式系统的优点。该项目将图结构与思想应用于分布式文件系统上面，使得分布式图文件系统兼具图文件系统方便用户快速搜索、模糊搜索、查找相关文件的特点以及分布式文件系统的海量文件存储、云存储的特点。dontpanic 实现了容器化、高可用性的分布式文件系统。

DisGraFS 并未完全实现其最初的设想，它的远程存储集群并没有真正搭建起来，DisGraFS 实际的实现中要求用户要将存储节点挂载到本地，形成一个所谓的客户端，这一项增加了用户的使用难度。本项目将以 2020 年的 dontpanic 为参考，搭建远程分布式存储集群，实现远程通信和远程文件传输。

此外，DisGraFS 缺少必要的监控组件，而监控在整个系统的开发运维中具有重要的作用，它可以对服务、系统、平台运行状态实时监控，收集运行信息，分析结果并预知存在的故障风险，一旦发生故障第一时间发出告警信息，最终保证系统持续、稳定、安全运行。本项目将致力于在 DisGraFS 上安装分布式监控系统，了解系统的运行状态，保证服务的正确且稳定运行。

## 小组成员以及分工

- 徐奥（组长）：
- 关浩祥：
- 牛午甲：
- 谭骏飞：
- 赵子毅：

## 立项依据

### DisGraFS

### dontpanic

## 项目设计

### 系统架构

### Neo4j

#### Neo4j 是什么

图数据库（graph database）是一个使用图结构进行查询的数据库，使用节点、边和属性来表示和存储数据。该系统的关键概念是图，它直接将存储中的数据项，与数据节点和节点间表示关系的边的集合相关联。这些关系允许直接将存储区中的数据链接在一起，并且在许多情况下，可以通过一个操作进行检索。

Neo4j 是一个高性能的 NOSQL 图形数据库。Neo4j基于其特殊的储存结构与Cypher 查询语言，设计并优化了多种图上的算法，使得查询、插入、删除等图操作的效率大大提高。我们使用 neo4j 来进行对图数据库的管理，根据标签与结点的相邻关系来进行检索，充分发挥图数据库的优势，提升文件索引的效率。

#### 改进内容

1. 同名不同类型之间文件的关联：

    DisGraFS的FILE节点只具有name和size两个有效属性,创建标签时除了来自打标的标签，还会新建一个与文件name同名的标签，可见他们也有实现这个功能的想法，但是出于种种原因未能实现。我们完成了这一点。

    我们将name拆分为name和ext，即将文件的名字和其拓展名拆分开，这使不同类型但同名文件之间的关联变得有可能（如ipadpro.pdf与ipadpro.png）

    创建与filename同名标签时 首先查询有无同名标签，若无则创建，有则跳过。然后新建关系时创建标签与文件关系即可。

2. 对路径操作的支持：

    DisGraFS的文件系统中虽然有目录结构，但是各个目录在neo4j中是一视同仁的，不能区分不同路径的同名文件。

    我们在图节点中新增了path属性，用于标识每一个文件的路径。支持了删除文件夹和重命名文件夹等路径操作。删除文件夹时通过正则匹配path属性，将path带有该前缀的节点全部删除，并适当删除孤立标签。重命名同理，通过字符串操作重新设置path属性即可。

3. 对多用户的支持：

    DisGraFS所有用户共享一个网盘。

    我们对所有节点，包括FILE和LABEL都添加了owner属性，标识该文件的所有者。在使用GraND Pro的过程中，用户的操作在图数据库里只涉及到修改自己的节点和关系。我们对前端页面查看同样做了隔离，使得所有用户都只能看到自己所有的文件和标签，从而实现GraND Pro对多用户的支持。

4. 支持更多操作：

    支持对文件进行删除，重命名，支持共享文件给其他用户。

5. 更高的执行效率：

    改进代码结构，使用更高效率的cypher查询语言命令。我们通过重新安排python代码结构及其与cypher查询语言之间的配合，提高了图数据库操作的执行效率。



### Ray

### Monitor

### 前端美化

### 前端增加功能

#### 文件操作

#### 目录操作

### Storage

#### 碎片删除

### Docker

### Websockets

### 用户操作

### 运维操作

## 效果展示

### 用户视角

### 运维视角

## 项目总结

## 致谢

## 参考文献
